name       : openjdk-8
version    : 8.172
release    : 13
source     :
    - https://solus-project.com/sources/java/jdk8u172-b00.tar.bz2 : 2a7305fa45b7f2e59200905f723f7a00a6aad84bb30b2a109b15337b96ad2762
    - https://solus-project.com/sources/java/corba-u172-b00.tar.bz2 : 79813d92d10b267c59bc67910ddeb8995a5ec19dfc67bc01384f261f7e4cfa17
    - https://solus-project.com/sources/java/hotspot-u172-b00.tar.bz2 : 2191289bfcb3d92f3a3ccc9c13ec991d344a8f71e3489fc19c33d546c953f405
    - https://solus-project.com/sources/java/jaxp-u172-b00.tar.bz2 : 67355bf9df372765dee3b6e6d9ca168cd2452c526971c7e32eebd5b6624dd6b1
    - https://solus-project.com/sources/java/jaxws-u172-b00.tar.bz2 : a4fc90f03a2802bacea87f568a3fc0d11c27cafbfe5c03cd8b76089c4fba7cce
    - https://solus-project.com/sources/java/jdk-u172-b00.tar.bz2 : 44f062c3fdd3788167e29fe5cb1b2a09112f2b3fdde50d70855e0abd9d2d4391
    - https://solus-project.com/sources/java/langtools-u172-b00.tar.bz2 : 8d21277d336c340f9c0bfb94b3d46531da0012a764b4f3137777967d36fd71b0
    - https://solus-project.com/sources/java/nashorn-u172-b00.tar.bz2 : 4e953e2b5d9c1a676d9111a248d8bb2c131b9d158d6c69eb224301cadc8b3a39
license    : GPL-2.0-with-classpath-exception
component  : programming.java
summary    : Open implementation of Oracle's Java Development Kit
description: |
    Open implementation of Oracle's Java Development Kit
builddeps  :
    - cups-devel
    - giflib-devel
    - openjdk-8-devel
    - pkgconfig(alsa)
    - pkgconfig(fontconfig)
    - pkgconfig(x11)
    - pkgconfig(xext)
    - pkgconfig(xrender)
    - pkgconfig(xt)
    - pkgconfig(xtst)
    - p7zip
setup      : |
    # Prep input tarballs
    unset LD_AS_NEEDED
    _SOLJVM_VERSION="u172-b00"
    for tarball in corba hotspot jaxp jaxws langtools jdk nashorn; do
        mkdir -pv ${tarball} &&
        tar -xf $sources/${tarball}-${_SOLJVM_VERSION}.tar.bz2 --strip-components=1 -C ${tarball}
    done
    unset _SOLJVM_VERSION
    unset JAVA_HOME
    
    # Now configure
    export SANEFLAGS="-std=c++98 -Wno-error -fno-delete-null-pointer-checks -fno-lifetime-dse"
    bash ./configure --prefix="$installdir/usr" \
        --with-update-version=172 \
        --with-build-number=b00 \
        --with-milestone=solus \
        --with-zlib=system \
        --with-giflib=system \
        --enable-unlimited-crypto \
        --with-cacerts-file=%libdir%/openjdk-8/jre/lib/security/cacerts \
        --with-jobs=%YJOBS% \
        --with-extra-cflags="$CFLAGS $SANEFLAGS" \
        --with-extra-cxxflags="$CXXFLAGS $SANEFLAGS" \
        --with-extra-ldflags="$LDFLAGS"
build      : |
    unset LD_AS_NEEDED
    make SCTP_WERROR= DISABLE_HOTSPOT_OS_VERSION_CHECK=ok all WARNINGS_ARE_ERRORS=
install    : |
    install -d -D -m 00755 $installdir/%libdir%
    make install
    
    # Binaries
    rm -rf $installdir/usr/bin/*
    mv $installdir/usr/jvm/openjdk-1.8.0_172-solus $installdir/%libdir%/openjdk-8
    rmdir $installdir/usr/jvm
    pushd $installdir/usr/bin
    for i in $installdir/%libdir%/openjdk-8/bin/*; do
      ln -sf %libdir%/openjdk-8/bin/`basename $i` .
    done
    popd
    
    # Docs
    install -m 00644 -D LICENSE $installdir/usr/share/doc/openjdk-8/LICENSE

    # Move into build dir
    pushd build/linux-x86_64-normal-server-release

    # Chuck the headers in
    install -D -d -m 00755 $installdir/usr/include/openjdk-8
    cp -ra jdk/include/* $installdir/usr/include/openjdk-8/.

    # Sort out the manpages
    install -D -d -m 00755 $installdir/usr/share/man/man1
    install -m 00644 images/j2re-image/man/man1/*.1 $installdir/usr/share/man/man1/.
    install -m 00644 images/j2sdk-image/man/man1/*.1 $installdir/usr/share/man/man1/.
    
    # Add java-jar.desktop into usable apps
    install -D -m 00644 $pkgfiles/java-jar.desktop $installdir/usr/share/applications/java-jar.desktop
